From b1349a56157a1de5bade0ed43a280948f8937cb5 Mon Sep 17 00:00:00 2001
From: Christoph Gerum <christoph.gerum@uni-tuebingen.de>
Date: Fri, 2 Apr 2021 16:00:35 +0200
Subject: [PATCH 1/3] rtfix

Missed changes from tvm patches
---
 src/runtime/crt/common/crt_backend_api.c | 2 +-
 src/runtime/crt/host/main.cc             | 6 +++---
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/src/runtime/crt/common/crt_backend_api.c b/src/runtime/crt/common/crt_backend_api.c
index 9a12bc282..233711fc4 100644
--- a/src/runtime/crt/common/crt_backend_api.c
+++ b/src/runtime/crt/common/crt_backend_api.c
@@ -40,7 +40,7 @@ void* TVMBackendAllocWorkspace(int device_type, int device_id, uint64_t nbytes,
   assert(nbytes > 0);
   err = TVMPlatformMemoryAllocate(nbytes, dev, &ptr);
   CHECK_EQ(err, kTvmErrorNoError,
-           "TVMBackendAllocWorkspace(%d, %d, %" PRIu64 ", %d, %d) -> %" PRId32, device_type,
+           "TVMBackendAllocWorkspace(%d, %d, %" "lli" ", %d, %d) -> %" "i", device_type,
            device_id, nbytes, dtype_code_hint, dtype_bits_hint, err);
   return ptr;
 }
diff --git a/src/runtime/crt/host/main.cc b/src/runtime/crt/host/main.cc
index e64455417..9e431a96b 100644
--- a/src/runtime/crt/host/main.cc
+++ b/src/runtime/crt/host/main.cc
@@ -45,7 +45,7 @@ extern "C" {
 ssize_t UTvmWriteFunc(void* context, const uint8_t* data, size_t num_bytes) {
   ssize_t to_return = write(STDOUT_FILENO, data, num_bytes);
   fflush(stdout);
-  fsync(STDOUT_FILENO);
+  //fsync(STDOUT_FILENO);
   return to_return;
 }
 
@@ -102,7 +102,7 @@ tvm_crt_error_t TVMPlatformGenerateRandom(uint8_t* buffer, size_t num_bytes) {
     random_seed = (unsigned int)time(NULL);
   }
   for (size_t i = 0; i < num_bytes; ++i) {
-    int random = rand_r(&random_seed);
+    int random = rand();
     buffer[i] = (uint8_t)random;
   }
 
@@ -116,7 +116,7 @@ static char** g_argv = NULL;
 
 int testonly_reset_server(TVMValue* args, int* type_codes, int num_args, TVMValue* out_ret_value,
                           int* out_ret_tcode, void* resource_handle) {
-  execvp(g_argv[0], g_argv);
+  //execvp(g_argv[0], g_argv);
   perror("utvm runtime: error restarting");
   return -1;
 }
-- 
2.25.1

